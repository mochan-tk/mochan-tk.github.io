<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>
    </head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var startRenderLoop = function (engine, canvas) {
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        }

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
        function attachHtml(id , W, H ,L , T ,p ,ts,content)
        {
            let deg = 180 / Math.PI; 
            let el = document.createElement('div');
            let exist = false;
            if(document.getElementById('spDiv'+id)) {
                exist = true;
                el = document.getElementById('spDiv'+id);
            }
           
            let zone = document.getElementById('canvasZone');
            let w = zone.offsetWidth.valueOf()*1;
            let h = zone.offsetHeight.valueOf()*1;
            
            el.setAttribute('style', 'transform: scale(1.0) scaleZ(1.0) rotateX('+ts.rx+'deg) rotateY('+ts.ry+'deg) rotateZ('+ts.rz+'deg);transform-origin: 50% 50%;perspective: '+p+';-webkit-transform: scale(1.0) scaleZ(1.0) rotateX('+ts.rx+'deg) rotateY('+ts.ry+'deg)  rotateZ('+ts.rz+'deg);-webkit-transform-origin: 50% 50%;-moz-transform: scale(1.0) scaleZ(1.0) rotateX('+ts.rx+'deg)  rotateY('+ts.ry+'deg) rotateZ('+ts.rz+'deg);-moz-transform-origin: 50% 50%;-o-transform: scale(1.0) scaleZ(1.0) rotateX('+ts.rx+'deg)  rotateY('+ts.ry+'deg) rotateZ('+ts.rz+'deg);-o-transform-origin: 50% 50%;-ms-transform: scale(1.0) scaleZ(1.0) rotateX('+ts.rx+'deg)  rotateY('+ts.ry+'deg) rotateZ('+ts.rz+'deg);-ms-transform-origin:50% 50%;transform: scale(1.0) scaleZ(1.0) rotateX('+ts.rx+'deg)  rotateY('+ts.ry+'deg)  rotateZ('+ts.rz+'deg);transform-origin: 50% 50%;position:absolute;top:'+(h/2-H/2+T)+'px;left:'+(w/2-W/2+L)+'px;z-index:100;background-color:#ffffff;width:'+W+'px;height:'+H+'px;opacity:1.;');
            el.id = "spDiv"+id;
            zone.setAttribute('style','-o-perspective: '+p+';-o-perspective-origin: 50% 50%;-webkit-perspective: '+p+';-webkit-perspective-origin: 50% 50%;-moz-perspective: '+p+';-moz-perspective-origin: 50% 50%;-ms-perspective: '+p+';-ms-perspective-origin: 50% 50%;perspective: '+p+';perspective-origin: 50% 50%;position:relative');
        
            if(!exist) { 
                el.innerHTML = content;
                zone.appendChild(el);
            }
        }
        
        function createPage(scene, camera, url = "https://doc.babylonjs.com/")
        {
            scene.registerBeforeRender(function() {  
                let cp = camera.position;
                let dx = Math.atan(Math.sqrt(cp.x * cp.x + cp.z * cp.z) / cp.y) * 180 / Math.PI;
                let dy = 0;
                let sign = 1;
                let baseSize = 180;
                if(dx > 0) { sign = -1; }
                let dz =  sign*Math.atan(cp.x/cp.z) * 180./Math.PI;			
                let size = baseSize * camera.fov / Math.sqrt(Math.pow(cp.x, 2.0) + Math.pow(cp.y, 2.0) + Math.pow(cp.z, 2.0));			
                attachHtml('PageWeb', baseSize * size, baseSize * size, 0, 0, '800px', {rx: dx, ry: dy, rz: dz} ,'<iframe src="'+url+'" width="100%" height="100%"></iframe>'); 				   
            });
        }
        
        var createScene = function () {
        
            var scene = new BABYLON.Scene(engine);
        
            var camera = new BABYLON.ArcRotateCamera("camera1",1,2,20, new BABYLON.Vector3(0, 50, 0.), scene);
            camera.setTarget(BABYLON.Vector3.Zero());
            camera.attachControl(canvas, true);
          
            var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;
        
            createPage(scene, camera);
        
            return scene;
        };
                window.initFunction = async function() {
                    
                    
                    var asyncEngineCreation = async function() {
                        try {
                        return createDefaultEngine();
                        } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                        }
                    }

                    window.engine = await asyncEngineCreation();
        if (!engine) throw 'engine should not be null.';
        startRenderLoop(engine, canvas);
        window.scene = createScene();};
        initFunction().then(() => {sceneToRender = scene                    
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
