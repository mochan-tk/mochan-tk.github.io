
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>タイトル</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid=""></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="handson-line-bot-power-automate-template"
                  title="タイトル"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="はじめに" duration="5">
        <h2 is-upgraded>概要</h2>
<p>LINE Botを作りつつ、Messaging API(および周辺の技術)の基本的な使い方を学んでいただければと思います！</p>
<h2 is-upgraded>当日の持ち物</h2>
<ul>
<li>LINEがインストール済みのスマホ</li>
<li>ChromeがインストールされたPC（Chromeのバージョンは最新のものを使っていただければと！）</li>
</ul>
<h2 is-upgraded>事前準備</h2>
<ul>
<li>Azureアカウント作成</li>
<li>Power Platformアカウント作成</li>
<li>LINEアカウント作成(こちらのサイトでログインできるかどうかを確認ください)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="LINE DevelopersでMessaging API チャネルを作成する" duration="10">
        <h2 is-upgraded>チャネルの作成スタート</h2>
<p><a href="https://developers.line.me/ja/services/messaging-api/" target="_blank">https://developers.line.me/ja/services/messaging-api/</a> にアクセス。<br>「今すぐはじめよう」のボタンを押して進めていきましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/389235956c37eff6.png"></p>
<p>「LINEアカウントでログイン」を押してください。</p>
<p class="image-container"><img style="width: 421.15px" src="img/d5d421a6b299e62b.png"></p>
<p>LINEのログインを求められるのでログインしてください。</p>
<p class="image-container"><img style="width: 461.50px" src="img/53764d1928b87a53.png"></p>
<h2 is-upgraded>チャネルの種類</h2>
<p>Messaging APIになっているか確認します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/df3af770985c3f97.png"></p>
<h2 is-upgraded>プロバイダ</h2>
<p>既にプロバイダーを作っている場合 → 利用するプロバイダーを選択しましょう。</p>
<p><img style="width: 601.70px" src="img/d5302f954b527b82.png"><br>初めて → 新規プロバイダー作成を選択しプロバイダー名を入力しましょう。</p>
<p>（LINEという文字は含められません。）</p>
<p class="image-container"><img style="width: 601.70px" src="img/ed9832698ea66cc2.png"></p>
<h2 is-upgraded>会社・事業者の所在国・地域</h2>
<p class="image-container"><img style="width: 601.70px" src="img/57aa97698a2fec50.png"></p>
<h2 is-upgraded>チャネルアイコン</h2>
<p>チャネルアイコンを登録しましょう。（今回は必須ではありません）</p>
<p class="image-container"><img style="width: 601.70px" src="img/b25e887321903ca7.png"></p>
<h2 is-upgraded>チャネル名、チャネル説明</h2>
<p>下記を入力しましょう。</p>
<p>チャネル名：「HandsonBot」</p>
<p>チャネル説明：「HandsonBotです。」</p>
<p class="image-container"><img style="width: 601.70px" src="img/f4ec1d14f0d71421.png"></p>
<h2 is-upgraded>大業種、小業種</h2>
<p class="image-container"><img style="width: 601.70px" src="img/ed9b424f40f943e3.png"></p>
<h2 is-upgraded>メールアドレス、プライバシーポリシーURL、サービス利用規約URL</h2>
<p>メールアドレスを確認しましょう。</p>
<p>プライバシーポリシーURLとサービス利用規約URLは入力しなくても大丈夫です。</p>
<p class="image-container"><img style="width: 601.70px" src="img/4912ddf28b5920c5.png"></p>
<h2 is-upgraded>作成ボタン</h2>
<p>下記２点の利用規約にチェックをして「作成」ボタンを押しましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/1b112e894430dc9f.png"></p>
<p>「OK」を押しましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/6151acd3510ea8dd.png"></p>
<p>「同意する」を押しましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/e87adc9a93775ef.png"></p>
<h2 is-upgraded>LINE公式アカウント(LINE Bot)と友だちになる</h2>
<p>QRコードで友だち追加</p>
<p>「Messaging API設定」タブに移動し、QRコードを読み取って、友だち追加をしましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/1868e4298aafce8.png"></p>
<h2 is-upgraded>アクセストークンの取得</h2>
<p>アクセストークンをメモします。_φ(･_･</p>
<p class="image-container"><img style="width: 601.70px" src="img/3ea1abd939970269.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/69e0eb2664c9a94b.png"></p>
<aside class="special"><p><strong>Note:</strong></p>
<p>・ アクセストークン：LINEのAPI(機能)を実行する際に、認可が通り利用権限があることを証明するトークン</p>
</aside>
<h2 is-upgraded>応答モードをOFFにする</h2>
<p>応答メッセージの「編集」をクリックして、Botの「応答モード」設定をOFFにします。（デフォルトの設定はONになっており、メッセージを送るたびにデフォルトのメッセージが返ってきてしまうため）</p>
<p class="image-container"><img style="width: 601.70px" src="img/e5483b923824e085.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/7041ff8828881bb9.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Power Automateでフロー作成してオウム返しBotの開発" duration="0">
        <h2 is-upgraded>サインイン</h2>
<p><a href="https://powerautomate.microsoft.com/" target="_blank">https://powerautomate.microsoft.com/</a> にアクセス。</p>
<p>「サインイン」のボタンを押して進めていきましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/1d9848d670a95c26.png"></p>
<p>サインインをしましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/a82d57bc555be1ec.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/a3d4591ae9ba177a.png"></p>
<p>本人確認を行いましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/cff88b83261736aa.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/b3e8e157fb73cda2.png"></p>
<h2 is-upgraded>おうむ返しを作成</h2>
<p>作成の「インスタントクラウドフロー」をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/b5575a4972ed02d6.png"></p>
<p>フロー名を入力、HTTP要求の受信時を選択し、「作成」をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/20978b5362b7478.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/f8d4aecd43334847.png"></p>
<p>下記をコピーして、JSONスキーマに入力します。</p>
<p>{</p>
<p>    &#34;properties&#34;: {</p>
<p>        &#34;events&#34;: {</p>
<p>            &#34;items&#34;: {</p>
<p>                &#34;properties&#34;: {</p>
<p>                    &#34;source&#34;: {</p>
<p>                        &#34;type&#34;: &#34;object&#34;,</p>
<p>                        &#34;properties&#34;: {</p>
<p>                            &#34;userId&#34;: {</p>
<p>                                &#34;type&#34;: &#34;string&#34;</p>
<p>                            }</p>
<p>                        }</p>
<p>                    },</p>
<p>                    &#34;message&#34;: {</p>
<p>                        &#34;properties&#34;: {</p>
<p>                            &#34;id&#34;: {</p>
<p>                                &#34;type&#34;: &#34;string&#34;</p>
<p>                            },</p>
<p>                            &#34;text&#34;: {</p>
<p>                                &#34;type&#34;: &#34;string&#34;</p>
<p>                            },</p>
<p>                            &#34;type&#34;: {</p>
<p>                                &#34;type&#34;: &#34;string&#34;</p>
<p>                            }</p>
<p>                        },</p>
<p>                        &#34;type&#34;: &#34;object&#34;</p>
<p>                    },</p>
<p>                    &#34;postback&#34;: {</p>
<p>                        &#34;properties&#34;: {</p>
<p>                            &#34;data&#34;: {</p>
<p>                                &#34;type&#34;: &#34;string&#34;</p>
<p>                            }</p>
<p>                        },</p>
<p>                        &#34;type&#34;: &#34;object&#34;</p>
<p>                    },</p>
<p>                    &#34;replyToken&#34;: {</p>
<p>                        &#34;type&#34;: &#34;string&#34;</p>
<p>                    },</p>
<p>                    &#34;type&#34;: {</p>
<p>                        &#34;type&#34;: &#34;string&#34;</p>
<p>                    }</p>
<p>                },</p>
<p>                &#34;required&#34;: [</p>
<p>                    &#34;replyToken&#34;,</p>
<p>                    &#34;type&#34;</p>
<p>                ],</p>
<p>                &#34;type&#34;: &#34;object&#34;</p>
<p>            },</p>
<p>            &#34;type&#34;: &#34;array&#34;</p>
<p>        }</p>
<p>    },</p>
<p>    &#34;type&#34;: &#34;object&#34;</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/e0140831a2dff5d1.png"></p>
<p>「新しいステップ」をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/ca9fc937fee751b5.png"></p>
<p>「変数を初期化する」と検索し、変数を初期化するをクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/7db3a498d6af7d5a.png"></p>
<p>下記のように設定し、新しいステップを入力します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/b5d66c832a6fd53b.png"></p>
<p>同じように、「変数を初期化する」と検索し、変数を初期化するをクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/7db3a498d6af7d5a.png"></p>
<p>下記のように設定し、新しいステップを入力します。</p>
<p>名前：access token</p>
<p>値：Bearer {LINE側でメモしたアクセストークン}</p>
<p class="image-container"><img style="width: 601.70px" src="img/9a8b7a4412ccecfe.png"></p>
<p>「スイッチ」と検索し、スイッチをクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/7ec7d2a3511604b7.png"></p>
<p>スイッチのオンに、動的なコンテンツ「type」を選択します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/ce53dd51fe39364f.png"></p>
<p>「type」はポップアップで下記のようになるのを確認します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/2cb95f7b006f2211.png"></p>
<p>ケースに「message」を入力し、「＋」をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/fa321f64d1bc666e.png"></p>
<p>次に「postback」を入力し、「message」側の「アクションの追加」をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/dd975f63b26c59b1.png"></p>
<p>同じように、スイッチを追加し、オンに動的なコンテンツから「type」、ケースには「text」を入力します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/e60fad7bc3fbc996.png"></p>
<p>「type」はポップアップで下記のようになるのを確認します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/5d9b400910113d79.png"></p>
<p>ケース「text」に「スイッチ」アクションを追加し、オンに動的なコンテンツから「text」、ケースに「flex」を入力し、既定の方に「アクションを追加」をクリックし、「文字列変数に追加」で検索し、文字列変数に追加を選択します。</p>
<p>下記のように設定しましょう。</p>
<p>{</p>
<p>  &#34;replyToken&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;replyToken&#39;]},</p>
<p>  &#34;messages&#34;: [</p>
<p>    {</p>
<p>      &#34;text&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;message&#39;]?[&#39;text&#39;]},</p>
<p>      &#34;type&#34;: &#34;text&#34;</p>
<p>    }</p>
<p>  ]</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/92e39653ffdbc979.png"></p>
<p>messageとpostbackのスイッチの下のアクションの追加をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/2c627a37d2305a32.png"></p>
<p>HTTPと検索し、「HTTP」を選択します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/ad3e3f91916d96ac.png"></p>
<p>下記のように設定します。</p>
<p>・方法 → POST</p>
<p>・URI → https://api.line.me/v2/bot/message/reply</p>
<p>・ヘッダー → Content-Type ： application/json</p>
<p>                 Authorization ： 動的コンテンツの「access token」</p>
<p>・本文 → @{variables(&#39;msg&#39;)}</p>
<p class="image-container"><img style="width: 601.70px" src="img/b1f95a9f88480161.png"></p>
<p>上部にある保存ボタンをクリックします。</p>
<p>「HTTP要求の受信時」にあるURLをコピーします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/24ccf54f4cc7bd9c.png"></p>
<p>LINE側のMessaging APIのWebhook URLに保存し、Webhookの利用をオンにします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/23bc8dbec712031e.png"></p>
<p>ここでおうむ返しの動作確認が可能</p>


      </google-codelab-step>
    
      <google-codelab-step label="リッチメニューを使う" duration="10">
        <h2 is-upgraded>フローのインポート</h2>
<p>パッケージのインポートを行います。</p>
<p class="image-container"><img style="width: 601.70px" src="img/46399218c4a9506c.png"></p>
<p>インポートするパッケージを選択します。</p>
<h2 is-upgraded><img style="width: 601.70px" src="img/62b450242c698c31.png"></h2>
<p>関連リソースを作成します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/f91715e80a172e25.png"></p>
<p>新しい接続をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/c587edf1a11f23e1.png"></p>
<p>「OneDrive」を選択し、作成します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/a2d7fbb7c1ce9244.png"></p>
<p>サインインをしましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/a82d57bc555be1ec.png"></p>
<p>前の画面にもどり、「一覧の更新」を行い、作成したリソースを選び「保存」します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/5b4c1e3380be6943.png"></p>
<p>インポートします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/9175503391f01b04.png"></p>
<p>フローを「オン」にします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/55f1c4065a4d9f99.png"></p>
<p>「編集」画面へ移動し、アクセストークンを変更します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/1050f67fb9d550bd.png"></p>
<p>「保存」をし、「実行」します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/9c80a571d358a27f.png"></p>
<p>トーク画面から一旦離れ、確認します。</p>
<p class="image-container"><img style="width: 290.94px" src="img/961950f8deaa4f81.png"><img style="width: 290.50px" src="img/28e11dc96011afe3.png"></p>
<h2 is-upgraded>[補足]エクスポートの方法</h2>
<p>エクスポートしたフローを選択し、パッケージでエクスポートをします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/a39511b020094cc6.png"></p>
<p>任意に名前をつけて、インポートの設定を選択し、保存します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/7e2b1e8cb6ef91a9.png"></p>
<p>エクスポートします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/95e4cbb27235ac96.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="URLスキームを使う" duration="5">
        <p>URLスキームを使うとカメラや位置情報などが起動できたりします、いくつか用意されていますので試していきましょう。</p>
<ul>
<li><a href="https://developers.line.biz/ja/docs/messaging-api/using-line-url-scheme/" target="_blank">https://developers.line.biz/ja/docs/messaging-api/using-line-url-scheme/</a></li>
</ul>
<h2 is-upgraded>カメラの起動</h2>
<p>リッチメニュー左上の「camera」をタップしてください。カメラが起動します。</p>
<p class="image-container"><img style="width: 305.00px" src="img/f13286f87be6ecd9.gif"></p>
<h2 is-upgraded>位置情報の起動</h2>
<p>リッチメニュー右上の「位置情報」をタップしてください。位置情報が起動します。</p>
<p class="image-container"><img style="width: 305.00px" src="img/c77d3984c67a9dc4.gif"></p>


      </google-codelab-step>
    
      <google-codelab-step label="様々なメッセージ形式を扱う" duration="10">
        <p>LINEでは様々なメッセージ形式を扱うことができます。</p>
<ul>
<li><a href="https://developers.line.biz/ja/docs/messaging-api/message-types/" target="_blank">https://developers.line.biz/ja/docs/messaging-api/message-types/</a></li>
</ul>
<h2 is-upgraded>Flex Messageを扱う</h2>
<p>おうむ返しのフローに戻り、ケース「flex」に「文字列変数に追加」アクションを追加し、下記を設定します。</p>
<p>保存します。</p>
<p>{</p>
<p>  &#34;replyToken&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;replyToken&#39;]},</p>
<p>  &#34;messages&#34;: [</p>
<p>    {</p>
<p>      &#34;type&#34;: &#34;flex&#34;,</p>
<p>      &#34;altText&#34;: &#34;item list&#34;,</p>
<p>      &#34;contents&#34;: {</p>
<p>        &#34;type&#34;: &#34;carousel&#34;,</p>
<p>        &#34;contents&#34;: [</p>
<p>          {</p>
<p>            &#34;type&#34;: &#34;bubble&#34;,</p>
<p>            &#34;hero&#34;: {</p>
<p>              &#34;type&#34;: &#34;image&#34;,</p>
<p>              &#34;size&#34;: &#34;full&#34;,</p>
<p>              &#34;aspectRatio&#34;: &#34;20:13&#34;,</p>
<p>              &#34;aspectMode&#34;: &#34;cover&#34;,</p>
<p>              &#34;url&#34;: &#34;https://scdn.line-apps.com/n/channel_devcenter/img/fx/01_5_carousel.png&#34;</p>
<p>            },</p>
<p>            &#34;body&#34;: {</p>
<p>              &#34;type&#34;: &#34;box&#34;,</p>
<p>              &#34;layout&#34;: &#34;vertical&#34;,</p>
<p>              &#34;spacing&#34;: &#34;sm&#34;,</p>
<p>              &#34;contents&#34;: [</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;text&#34;,</p>
<p>                  &#34;text&#34;: &#34;Arm Chair, White&#34;,</p>
<p>                  &#34;wrap&#34;: true,</p>
<p>                  &#34;weight&#34;: &#34;bold&#34;,</p>
<p>                  &#34;size&#34;: &#34;xl&#34;</p>
<p>                },</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;box&#34;,</p>
<p>                  &#34;layout&#34;: &#34;baseline&#34;,</p>
<p>                  &#34;contents&#34;: [</p>
<p>                    {</p>
<p>                      &#34;type&#34;: &#34;text&#34;,</p>
<p>                      &#34;text&#34;: &#34;$49&#34;,</p>
<p>                      &#34;wrap&#34;: true,</p>
<p>                      &#34;weight&#34;: &#34;bold&#34;,</p>
<p>                      &#34;size&#34;: &#34;xl&#34;,</p>
<p>                      &#34;flex&#34;: 0</p>
<p>                    },</p>
<p>                    {</p>
<p>                      &#34;type&#34;: &#34;text&#34;,</p>
<p>                      &#34;text&#34;: &#34;.99&#34;,</p>
<p>                      &#34;wrap&#34;: true,</p>
<p>                      &#34;weight&#34;: &#34;bold&#34;,</p>
<p>                      &#34;size&#34;: &#34;sm&#34;,</p>
<p>                      &#34;flex&#34;: 0</p>
<p>                    }</p>
<p>                  ]</p>
<p>                }</p>
<p>              ]</p>
<p>            },</p>
<p>            &#34;footer&#34;: {</p>
<p>              &#34;type&#34;: &#34;box&#34;,</p>
<p>              &#34;layout&#34;: &#34;vertical&#34;,</p>
<p>              &#34;spacing&#34;: &#34;sm&#34;,</p>
<p>              &#34;contents&#34;: [</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;button&#34;,</p>
<p>                  &#34;style&#34;: &#34;primary&#34;,</p>
<p>                  &#34;action&#34;: {</p>
<p>                    &#34;type&#34;: &#34;uri&#34;,</p>
<p>                    &#34;label&#34;: &#34;Add to Cart&#34;,</p>
<p>                    &#34;uri&#34;: &#34;https://linecorp.com&#34;</p>
<p>                  }</p>
<p>                },</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;button&#34;,</p>
<p>                  &#34;action&#34;: {</p>
<p>                    &#34;type&#34;: &#34;uri&#34;,</p>
<p>                    &#34;label&#34;: &#34;Add to wishlist&#34;,</p>
<p>                    &#34;uri&#34;: &#34;https://linecorp.com&#34;</p>
<p>                  }</p>
<p>                }</p>
<p>              ]</p>
<p>            }</p>
<p>          },</p>
<p>          {</p>
<p>            &#34;type&#34;: &#34;bubble&#34;,</p>
<p>            &#34;hero&#34;: {</p>
<p>              &#34;type&#34;: &#34;image&#34;,</p>
<p>              &#34;size&#34;: &#34;full&#34;,</p>
<p>              &#34;aspectRatio&#34;: &#34;20:13&#34;,</p>
<p>              &#34;aspectMode&#34;: &#34;cover&#34;,</p>
<p>              &#34;url&#34;: &#34;https://scdn.line-apps.com/n/channel_devcenter/img/fx/01_6_carousel.png&#34;</p>
<p>            },</p>
<p>            &#34;body&#34;: {</p>
<p>              &#34;type&#34;: &#34;box&#34;,</p>
<p>              &#34;layout&#34;: &#34;vertical&#34;,</p>
<p>              &#34;spacing&#34;: &#34;sm&#34;,</p>
<p>              &#34;contents&#34;: [</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;text&#34;,</p>
<p>                  &#34;text&#34;: &#34;Metal Desk Lamp&#34;,</p>
<p>                  &#34;wrap&#34;: true,</p>
<p>                  &#34;weight&#34;: &#34;bold&#34;,</p>
<p>                  &#34;size&#34;: &#34;xl&#34;</p>
<p>                },</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;box&#34;,</p>
<p>                  &#34;layout&#34;: &#34;baseline&#34;,</p>
<p>                  &#34;flex&#34;: 1,</p>
<p>                  &#34;contents&#34;: [</p>
<p>                    {</p>
<p>                      &#34;type&#34;: &#34;text&#34;,</p>
<p>                      &#34;text&#34;: &#34;$11&#34;,</p>
<p>                      &#34;wrap&#34;: true,</p>
<p>                      &#34;weight&#34;: &#34;bold&#34;,</p>
<p>                      &#34;size&#34;: &#34;xl&#34;,</p>
<p>                      &#34;flex&#34;: 0</p>
<p>                    },</p>
<p>                    {</p>
<p>                      &#34;type&#34;: &#34;text&#34;,</p>
<p>                      &#34;text&#34;: &#34;.99&#34;,</p>
<p>                      &#34;wrap&#34;: true,</p>
<p>                      &#34;weight&#34;: &#34;bold&#34;,</p>
<p>                      &#34;size&#34;: &#34;sm&#34;,</p>
<p>                      &#34;flex&#34;: 0</p>
<p>                    }</p>
<p>                  ]</p>
<p>                },</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;text&#34;,</p>
<p>                  &#34;text&#34;: &#34;Temporarily out of stock&#34;,</p>
<p>                  &#34;wrap&#34;: true,</p>
<p>                  &#34;size&#34;: &#34;xxs&#34;,</p>
<p>                  &#34;margin&#34;: &#34;md&#34;,</p>
<p>                  &#34;color&#34;: &#34;#ff5551&#34;,</p>
<p>                  &#34;flex&#34;: 0</p>
<p>                }</p>
<p>              ]</p>
<p>            },</p>
<p>            &#34;footer&#34;: {</p>
<p>              &#34;type&#34;: &#34;box&#34;,</p>
<p>              &#34;layout&#34;: &#34;vertical&#34;,</p>
<p>              &#34;spacing&#34;: &#34;sm&#34;,</p>
<p>              &#34;contents&#34;: [</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;button&#34;,</p>
<p>                  &#34;flex&#34;: 2,</p>
<p>                  &#34;style&#34;: &#34;primary&#34;,</p>
<p>                  &#34;color&#34;: &#34;#aaaaaa&#34;,</p>
<p>                  &#34;action&#34;: {</p>
<p>                    &#34;type&#34;: &#34;uri&#34;,</p>
<p>                    &#34;label&#34;: &#34;Add to Cart&#34;,</p>
<p>                    &#34;uri&#34;: &#34;https://linecorp.com&#34;</p>
<p>                  }</p>
<p>                },</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;button&#34;,</p>
<p>                  &#34;action&#34;: {</p>
<p>                    &#34;type&#34;: &#34;uri&#34;,</p>
<p>                    &#34;label&#34;: &#34;Add to wish list&#34;,</p>
<p>                    &#34;uri&#34;: &#34;https://linecorp.com&#34;</p>
<p>                  }</p>
<p>                }</p>
<p>              ]</p>
<p>            }</p>
<p>          },</p>
<p>          {</p>
<p>            &#34;type&#34;: &#34;bubble&#34;,</p>
<p>            &#34;body&#34;: {</p>
<p>              &#34;type&#34;: &#34;box&#34;,</p>
<p>              &#34;layout&#34;: &#34;vertical&#34;,</p>
<p>              &#34;spacing&#34;: &#34;sm&#34;,</p>
<p>              &#34;contents&#34;: [</p>
<p>                {</p>
<p>                  &#34;type&#34;: &#34;button&#34;,</p>
<p>                  &#34;flex&#34;: 1,</p>
<p>                  &#34;gravity&#34;: &#34;center&#34;,</p>
<p>                  &#34;action&#34;: {</p>
<p>                    &#34;type&#34;: &#34;uri&#34;,</p>
<p>                    &#34;label&#34;: &#34;See more&#34;,</p>
<p>                    &#34;uri&#34;: &#34;https://linecorp.com&#34;</p>
<p>                  }</p>
<p>                }</p>
<p>              ]</p>
<p>            }</p>
<p>          }</p>
<p>        ]</p>
<p>      }</p>
<p>    }</p>
<p>  ]</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/c4b8a238071da9ad.png"></p>
<p>リッチメニューの左下をタップして、「flex」というテキストメッセージを投稿します。するとちょっとリッチなUIが返ってくると思います。これがFlex Messageです。<a href="https://developers.line.biz/flex-simulator/" target="_blank">Flex Message Simulator</a> が用意されており、レイアウトを簡単にカスタマイズすることができます。（詳細は<a href="https://developers.line.biz/ja/docs/messaging-api/using-flex-message-simulator/" target="_blank">コチラ</a>を参照ください。）</p>
<p class="image-container"><img style="width: 305.00px" src="img/81d3c8209c747f44.gif"></p>
<h2 is-upgraded>Quick Replyを扱う</h2>
<p>flexの隣にケース２を追加し、「quick」と入力する。</p>
<p>flexと同じように「文字列変数に追加」アクションを追加し、下記を設定します。</p>
<p>{</p>
<p>  &#34;replyToken&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;replyToken&#39;]},</p>
<p>  &#34;messages&#34;: [</p>
<p>    {</p>
<p>      &#34;text&#34;: &#34;ステッカー欲しいですか❓YesかNoで答えてください, もしくは素敵な写真送って❗️&#34;,</p>
<p>      &#34;quickReply&#34;: {</p>
<p>        &#34;items&#34;: [</p>
<p>          {</p>
<p>            &#34;type&#34;: &#34;action&#34;,</p>
<p>            &#34;action&#34;: {</p>
<p>              &#34;type&#34;: &#34;postback&#34;,</p>
<p>              &#34;label&#34;: &#34;Yes&#34;,</p>
<p>              &#34;data&#34;: &#34;sticker&#34;,</p>
<p>              &#34;displayText&#34;: &#34;ステッカーください❗️&#34;</p>
<p>            }</p>
<p>          },</p>
<p>          {</p>
<p>            &#34;type&#34;: &#34;action&#34;,</p>
<p>            &#34;action&#34;: {</p>
<p>              &#34;type&#34;: &#34;message&#34;,</p>
<p>              &#34;label&#34;: &#34;No&#34;,</p>
<p>              &#34;text&#34;: &#34;不要。&#34;</p>
<p>            }</p>
<p>          },</p>
<p>          {</p>
<p>            &#34;type&#34;: &#34;action&#34;,</p>
<p>            &#34;action&#34;: {</p>
<p>              &#34;type&#34;: &#34;camera&#34;,</p>
<p>              &#34;label&#34;: &#34;camera&#34;</p>
<p>            }</p>
<p>          }</p>
<p>        ]</p>
<p>      },</p>
<p>      &#34;type&#34;: &#34;text&#34;</p>
<p>    }</p>
<p>  ]</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/905cc62621d4b064.png"></p>
<p>上部にあるケース２「postback」に移動し、「スイッチ」と「文字列変数に追加」のアクションを追加する。</p>
<p>「スイッチ」のオンに動的コンテンツから「data」、ケースに「sticker」を入力し、「文字列変数に追加」に下記を設定します。</p>
<p>保存します。</p>
<p>{</p>
<p>  &#34;replyToken&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;replyToken&#39;]},</p>
<p>  &#34;messages&#34;: [</p>
<p>    {</p>
<p>      &#34;type&#34;: &#34;sticker&#34;,</p>
<p>      &#34;packageId&#34;: &#34;11537&#34;,</p>
<p>      &#34;stickerId&#34;: &#34;52002735&#34;</p>
<p>    }</p>
<p>  ]</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/dfe7cbcdd6726c6f.png"></p>
<p>クイックリプライを使うとユーザは簡単に返信を行うことができます。</p>
<p class="image-container"><img style="width: 305.00px" src="img/c9c578aa154790e8.gif"></p>
<aside class="special"><p><strong>Note:</strong> 今回クイックリプライには「Yes」、「No」、「camera」の選択肢を用意しました。「Yes」とするとpostbackというメッセージの送信を行うようにしています。</p>
<p>詳しくは下記を参照ください。</p>
<p>https://developers.line.biz/ja/docs/messaging-api/actions/#postback-action</p>
</aside>
<h2 is-upgraded>位置情報メッセージを扱う</h2>
<p>ケース「message」側に戻り、ケース「text」の隣にケース２「location」を追加し、文字列変数に追加アクションに下記を設定します。</p>
<p>保存します。</p>
<p>{</p>
<p>  &#34;replyToken&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;replyToken&#39;]},</p>
<p>  &#34;messages&#34;: [</p>
<p>    {</p>
<p>      &#34;type&#34;: &#34;location&#34;,</p>
<p>      &#34;title&#34;: &#34;現在地&#34;,</p>
<p>      &#34;address&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;message&#39;]?[&#39;address&#39;]},</p>
<p>      &#34;latitude&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;message&#39;]?[&#39;latitude&#39;]},</p>
<p>      &#34;longitude&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;message&#39;]?[&#39;longitude&#39;]}</p>
<p>    }</p>
<p>  ]</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/fec77a8800826f85.png"></p>
<p>位置情報をトーク画面に投稿してみてください。全く同じ位置情報メッセージが返ってくると思います。</p>
<p class="image-container"><img style="width: 314.70px" src="img/296c40c60046721f.png"></p>
<h2 is-upgraded>画像メッセージを扱う</h2>
<p>ケース２「location」のとなりに、ケース３「image」を追加します。</p>
<p>そこに、HTTPアクションを追加し、送った画像のコンテンツを取得します。</p>
<p>下記のように設定し保存します。</p>
<p>・方法 → GET</p>
<p>・URI → https://api-data.line.me/v2/bot/message/@{items(&#39;Apply_to_each&#39;)?[&#39;message&#39;]?[&#39;id&#39;]}/content</p>
<p>・ヘッダー → Authorization ： 動的コンテンツの「access token」</p>
<p class="image-container"><img style="width: 601.70px" src="img/93cb0eabeeec3187.png"></p>
<p>Azureアカウントに接続し、ストレージアカウントを作成します。</p>
<p><a href="https://portal.azure.com/#create/Microsoft.StorageAccount-ARM" target="_blank">https://portal.azure.com/#create/Microsoft.StorageAccount-ARM</a></p>
<p class="image-container"><img style="width: 601.70px" src="img/8ad1ff242422c03a.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/1b07234cc68390d2.png"></p>
<p>コンテナを作成します。</p>
<p class="image-container"><img style="width: 601.70px" src="img/d2319d9d7ae4ec2c.png"></p>
<p>送った画像を保存するために下記のロールを追加します。</p>
<p>・ストレージ BLOB データ共同作成者</p>
<p class="image-container"><img style="width: 601.70px" src="img/cf1560c84e4ead91.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/91bf600ea8b39fd4.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/11437e71a731a26c.png"></p>
<p class="image-container"><img style="width: 601.70px" src="img/b684f481bc86d803.png"></p>
<p>Power Automate画面に戻り、「HTTP」アクションの下に「BLOB を作成する(V2)」アクションを追加します。</p>
<p>サインインをします。</p>
<p class="image-container"><img style="width: 601.70px" src="img/736ab61f5a18040e.png"><img style="width: 601.70px" src="img/705fc23fa3b3573a.png"></p>
<p>ストレージアカウント名は「カスタム値の入力」を選択してから、Azureで作成したアカウント名を入力します。</p>
<p>フォルダパスは右にあるフォルダマークを押して選択します。</p>
<p>・BLOB名：動的コンテンツの「id」</p>
<p>・BLOBコンテンツ：動的コンテンツの「本文」</p>
<p class="image-container"><img style="width: 601.70px" src="img/378bdc505c6c4a36.png"></p>
<p>「文字列変数に追加」アクションを追加し、下記を入力します。</p>
<p>{ストレージアカウント名}に、Azureで作成したアカウント名に置き換えます。</p>
<p>保存します。</p>
<p>{</p>
<p>  &#34;replyToken&#34;: @{items(&#39;Apply_to_each&#39;)?[&#39;replyToken&#39;]},</p>
<p>  &#34;messages&#34;: [</p>
<p>    {</p>
<p>      &#34;type&#34;: &#34;image&#34;,</p>
<p>      &#34;originalContentUrl&#34;: &#34;https://{ストレージアカウント名}.blob.core.windows.net@{outputs(&#39;BLOB_を作成する_(V2)&#39;)?[&#39;body/Path&#39;]}&#34;,</p>
<p>      &#34;previewImageUrl&#34;: &#34;https://{ストレージアカウント名}.blob.core.windows.net@{outputs(&#39;BLOB_を作成する_(V2)&#39;)?[&#39;body/Path&#39;]}&#34;</p>
<p>    }</p>
<p>  ]</p>
<p>}</p>
<p class="image-container"><img style="width: 601.70px" src="img/480aa704a1cf578c.png"></p>
<p>カメラを起動して写真を撮るか既に撮った写真を選択するかで、画像をトーク画面に投稿してみてください。送った画像をそのまま返すコードを今回用意しました。</p>
<p class="image-container"><img style="width: 314.16px" src="img/e702d58f7892288f.png"></p>
<aside class="special"><p><strong>Note:</strong> 投稿した画像をそのまま返すにあたり、コードでは [投稿された画像をAzure Storageに格納] &gt; [Azure Storageに格納された画像のURLを取得] &gt; [画像メッセージとしてユーザに返す] という流れで実施しています。</p>
</aside>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
